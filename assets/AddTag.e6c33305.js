import{d as e,e as a,r as t,q as l,n,f as s,a as o,c,g as r,h as d,u,o as i,L as f,_ as p,t as g,v as m,x as v,F as x,B as h}from"./index.2a861458.js";import{_ as w}from"./LabeledInput.6643dd43.js";import"./Loading.1dab7a6b.js";import{l as T,a as b,_ as y}from"./AddTagStepTrack.ba90764f.js";import{_ as k,L as S}from"./Dropdown.8a21d7af.js";import{N as D}from"./nfc-tag.class.5688d583.js";var j=e({name:"AddTagStepInfo",components:{Textfield:a,Dropdown:k,LabeledInput:w},props:{nfcTag:{type:Object,required:!0}},emits:{"update:nfc-tag":e=>!0,"update:is-valid":e=>!0},setup(e,a){const s=t(e.nfcTag),o=t([]),c=t([]),r=l({get:()=>s.value.group?new S(s.value.group):null,set:e=>e&&u("group",e.value)}),d=l({get:()=>s.value.name,set:e=>u("name",e)});function u(e,t){s.value[e]=t;const l=!(!s.value.group||!s.value.name);a.emit("update:nfc-tag",s.value),a.emit("update:is-valid",l)}return async function(){const e=await n.service("nfc-tags").find();o.value=T.uniq(e.data.map((e=>e.group))),c.value=o.value.map((e=>new S(e)))}().catch((()=>{throw Error("failed to load group names")})),{tagName:d,groupListItems:c,selectedGroup:r}}});const V={class:"w-full p-4 h-full flex flex-col items-center"};j.render=function(e,a,t,l,n,u){const i=s("Textfield"),f=s("LabeledInput"),p=s("Dropdown");return o(),c("div",V,[r(f,{label:"Tag Name",class:"w-full"},{default:d((()=>[r(i,{modelValue:e.tagName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.tagName=a),placeholder:"z. B. Mario Figur",class:"rounded-full"},null,8,["modelValue"])])),_:1}),r(f,{label:"Gruppe",class:"w-full mt-8"},{default:d((()=>[r(p,{modelValue:e.selectedGroup,"onUpdate:modelValue":a[2]||(a[2]=a=>e.selectedGroup=a),items:e.groupListItems,"onUpdate:items":a[3]||(a[3]=a=>e.groupListItems=a),removeable:!1,"placeholder-text":"WÃ¤hle eine Gruppe","enable-add-item":""},null,8,["modelValue","items"])])),_:1})])};var I=e({name:"AddTagStepPlaceOnReader",props:{nfcTag:{type:Object,default:null}},emits:{proceed:()=>!0,"update:nfc-tag":e=>!0,"update:is-valid":e=>!0},setup(e,a){const l=t(),s=u(),o=e=>{(async()=>{if(!e.attachedTagData)return;const t=await n.service("nfc-tags").find({query:{nfcData:e.attachedTagData}});t.total>0&&(alert("Der Tag wurde bereits angelegt!"),s.push({name:"tag-details",params:{tagId:t.data[0]._id}})),l.value&&(l.value.nfcData=e.attachedTagData,a.emit("update:nfc-tag",l.value),a.emit("proceed"))})()};i((()=>{l.value=new D,a.emit("update:nfc-tag",l.value),n.service("nfc-readers").on("patched",o).on("updated",o)})),f((()=>{n.service("nfc-readers").off("patched",o).off("updated",o)}))}});const L={class:"add-tag-step-place-tag-on-reader p-6 flex h-full w-full my-auto"},N=r("img",{class:"object-contain",src:"/assets/attach-tag.59c277b1.gif"},null,-1);I.render=function(e,a,t,l,n,s){return o(),c("div",L,[N])};var C=e({name:"AddTag",components:{Button:p},setup(){const e=t(null),a=[I,j,b,y],l=t(0),s=t(!1),o=u();return{activeStep:l,steps:a,nfcTag:e,saveTag:async()=>{e.value&&(await n.service("nfc-tags").create(e.value),o.push({name:"home"}),alert("Neuen Tag erfolgreich erstellt."))},previousStep:()=>{s.value=!0,l.value-=1},nextStep:()=>{s.value=!1,l.value+=1},dataValid:s}}});const _={class:"add-tag w-full flex flex-col"},G={class:"p-8 flex flex-row"},U={class:"headlines ml-2 flex flex-col my-auto"},q=r("span",{class:"text-3xl"},"Neuen Tag anlegen",-1),A={key:0},B={class:"bg-gradient-to-b from-primary to-secondary w-full flex flex-col flex-grow overflow-y-auto"},F={class:"flex flex-col items-center"},z={class:"steps flex flex-row justify-center transform -translate-y-3 bg-white rounded-t-md px-2 py-1"},O={class:"actions flex flex-row w-full justify-center mb-4 px-4"},P={key:3,class:"text-center"};C.render=function(e,a,t,l,n,d){const u=s("Button");return o(),c("div",_,[r("header",G,[r(u,{back:"",round:"",icon:"fas fa-times",class:"h-10 w-10","icon-size":6}),r("div",U,[q,e.nfcTag&&e.nfcTag.nfcData?(o(),c("span",A,"Tag-ID: #"+g(e.nfcTag.nfcData),1)):m("",!0)])]),r("main",B,[(o(),c(v(e.steps[e.activeStep]),{"nfc-tag":e.nfcTag,"onUpdate:nfc-tag":a[1]||(a[1]=a=>e.nfcTag=a),"onUpdate:isValid":a[2]||(a[2]=a=>e.dataValid=a),onProceed:e.nextStep},null,8,["nfc-tag","onProceed"]))]),r("footer",F,[r("ul",z,[(o(!0),c(x,null,h(e.steps.length,(a=>(o(),c("li",{key:a,class:"mx-2"},g(e.activeStep===a-1?"x":"o"),1)))),128))]),r("div",O,[0!==e.activeStep?(o(),c(u,{key:0,round:"","text-size":5,icon:"fas fa-chevron-left",class:"mr-4 px-4 py-2 text-center",onClick:e.previousStep},null,8,["onClick"])):m("",!0),e.activeStep===e.steps.length-1?(o(),c(u,{key:1,round:"",class:"flex-grow p-2",icon:"fas fa-download",text:"Tag erstellen",enabled:e.dataValid,onClick:e.saveTag},null,8,["enabled","onClick"])):0!==e.activeStep?(o(),c(u,{key:2,class:"flex-grow p-2",icon:"fas fa-chevron-right",round:"",text:"Weiter",enabled:e.dataValid,onClick:e.nextStep},null,8,["enabled","onClick"])):(o(),c("span",P,"Zum Fortfahren bitte NFC Tag an den Reader halten!"))])])])};export default C;

import{B as e,d as a,H as l,e as t,r as s,y as n,b as r,I as i,f as c,a as o,c as u,g as d,h as f,q as g,J as p,o as m,p as v,j as x,t as y,F as h,n as w,k,K as T}from"./index.cb495e94.js";import{_ as b}from"./LabeledInput.dfc7a733.js";import{_ as U}from"./Loading.3a651a22.js";async function I(a){return await e.service("spotify-tracks").get(a.trackUri)}async function L(a){const l=await e.service("nfc-tags").find({query:{nfcData:a}});return 0===l.total?null:l.data[1]}const S=/((https)|(http)):\/\/.*/i;var j=a({name:"TagStepImage",components:{LabeledInput:b,TagEntry:l,Textfield:t},props:{nfcTag:{type:Object,required:!0}},emits:{"update:nfc-tag":e=>!0,"update:is-valid":e=>!0},setup(e,a){const l=s(),t=s(),c=n((()=>t.value&&!S.test(t.value)?null:t.value)),o=s(null),u=n({get:()=>e.nfcTag.imageUrl,set:l=>{const t=e.nfcTag;t.imageUrl=l,a.emit("update:nfc-tag",t),a.emit("update:is-valid",""!==l)}});return r((async()=>{const a=await I(e.nfcTag);l.value=a.imageUri,u.value!==l.value?S.test(u.value)&&(t.value=u.value,o.value="external"):o.value="spotify"})),i(o,(e=>{"spotify"===e&&l.value&&(u.value=l.value),"external"===e&&(u.value=t.value||"")})),i(t,(()=>{u.value=t.value||""})),{imageSource:o,spotifyImageUrl:l,sanitizedExternalImageUrl:c,externalImageUrl:t}}});const E={class:"add-tag-step-image flex flex-grow flex-col justify-start items-start px-8 py-5"},_={class:"flex content-end"},V={class:"flex content-end"};j.render=function(e,a,l,t,s,n){const r=c("TagEntry"),i=c("LabeledInput"),p=c("Textfield");return o(),u("div",E,[d(i,{label:"Bild von Spotify"},{default:f((()=>[d("div",_,[d(r,{class:"w-44 cursor-pointer",img:e.spotifyImageUrl||"/image-gallery.svg",selected:"spotify"===e.imageSource,onClick:a[1]||(a[1]=a=>e.imageSource="spotify")},null,8,["img","selected"])])])),_:1}),d(i,{label:"Eigenes Bild",class:"mt-8"},{default:f((()=>[d("div",V,[d(r,{class:"w-44 cursor-pointer",img:e.sanitizedExternalImageUrl||"/image-gallery.svg",selected:"external"===e.imageSource,onClick:a[2]||(a[2]=a=>e.imageSource="external")},null,8,["img","selected"])]),"external"===e.imageSource?(o(),u(p,{key:0,modelValue:e.externalImageUrl,"onUpdate:modelValue":a[3]||(a[3]=a=>e.externalImageUrl=a),class:"mt-2 w-full",placeholder:"Bild URL"},null,8,["modelValue"])):g("",!0)])),_:1})])};var q=a({name:"TagStepTrack",components:{Textfield:t,TagEntry:l,Loading:U},props:{nfcTag:{type:Object,required:!0}},emits:{"update:nfc-tag":e=>!0,"update:is-valid":e=>!0},setup(a,l){const t=s(""),n=s(!1),r=s([]),c=s(),o=p.debounce((async()=>{r.value=await async function(a){const l={query:{name:a}};return await e.service("spotify-tracks").find(l)}(t.value),n.value=!1}),500);i(t,(async e=>{e.length>=3&&(n.value=!0,await o())}));return m((async()=>{if(a.nfcTag.trackUri){const e=await I(a.nfcTag);t.value=e.title,c.value=e}})),{search:t,isLoading:n,tracks:r,changeTrack:e=>{c.value=e;const t=a.nfcTag;t.trackUri=e.uri;const s=!!e.uri;l.emit("update:nfc-tag",t),l.emit("update:is-valid",s)},selectedTrack:c}}});const B=k("data-v-1ec11680");v("data-v-1ec11680");const C={class:"add-tag-step-track flex flex-col relative h-full w-full"},z={class:"search px-4"},K={key:0,class:"loading flex m-auto p-2"},O={key:1,class:"flex m-auto text-center p-2"},D=d("span",{class:"text-white font-heading text-3xl"},[d("p",null,"Wähle ein schönes Lied"),d("p",null,"für deinen Tag!")],-1),F={key:2,class:"m-auto text-center justify-center p-2"},H=d("img",{class:"mb-4",src:T},null,-1),J={class:"text-white font-heading text-2xl"},R=d("p",null,"Keine Ergebnisse für",-1),W={key:3,class:"flex flex-col mt-4 pb-6 w-full overflow-y-auto max-h-full"},A={class:"flex flex-col text-white overflow-hidden"},G={class:"ml-4 text-lg font-bold whitespace-nowrap overflow-hidden overflow-ellipsis"},M={class:"ml-4 text-base whitespace-nowrap overflow-hidden overflow-ellipsis"};x();const N=B(((e,a,l,t,s,n)=>{const r=c("Textfield"),i=c("Loading"),f=c("TagEntry");return o(),u("div",C,[d("div",z,[d(r,{modelValue:e.search,"onUpdate:modelValue":a[1]||(a[1]=a=>e.search=a),class:"w-full",placeholder:"Suche einen Titel ...",icon:"fas fa-search"},null,8,["modelValue"])]),e.isLoading?(o(),u("div",K,[d(i)])):e.search.length<3?(o(),u("div",O,[D])):e.search.length>=3&&0===e.tracks.length?(o(),u("div",F,[H,d("span",J,[R,d("p",null,'"'+y(e.search)+'"',1)])])):(o(),u("ul",W,[(o(!0),u(h,null,w(e.tracks,(a=>(o(),u("li",{key:a.uri,class:["flex flex-row py-2 px-2 rounded-2xl w-5/6 mx-auto cursor-pointer border border-transparent",{"shadow-xl border-yellow-400":e.selectedTrack&&a.uri===e.selectedTrack.uri}],onClick:l=>e.changeTrack(a)},[d(f,{img:a.imageUri,class:"w-20 h-20 flex-shrink-0"},null,8,["img"]),d("div",A,[d("span",G,y(a.title),1),d("span",M,y(a.artist),1)])],10,["onClick"])))),128))]))])}));q.render=N,q.__scopeId="data-v-1ec11680";export{q as _,j as a,I as b,L as g};
